# 生产模式覆盖：前端构建 + Nginx，后端 node dist。
# 端口由单独文件指定，避免与主站 80 冲突时合并出 80+8080 导致 80 绑定失败。
# 与主站共存（px.ibizsoft.cn）：-f docker-compose.port8080.yml → 前端 8080
# 独占 80：-f docker-compose.port80.yml → 前端 80
name: mediation

services:
  backend:
    build:
      context: ./server
      dockerfile: Dockerfile
    image: mediation-backend:latest
    volumes: []
    command: sh -c "npx prisma migrate deploy && node dist/index.js"

  frontend:
    build:
      context: .
      dockerfile: Dockerfile
    image: mediation-frontend:latest
    volumes: []
    command: ["nginx", "-g", "daemon off;"]
    ports: []   # 覆盖 base 的 3000，实际端口由 port8080/port80 指定
    depends_on:
      - backend
