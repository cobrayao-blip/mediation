
import { Difficulty, Scenario, MediationSkill } from './types';

// 技巧库将从后端API动态加载，这里保留作为fallback
// 实际使用时，前端会从 /api/skills 接口获取启用的技巧列表
export const SKILLS_LIBRARY: MediationSkill[] = [
  {
    name: "积极倾听 (Active Listening)",
    category: "沟通技巧",
    description: "通过重复、总结和情绪确认，让当事人感受到被理解，是建立信任的基石。",
    howToUse: "在当事人陈述完毕后，先不要下结论，而是用自己的语言复述对方的核心诉求和感受。",
    phrasings: [
      "我听明白了，您最在意的是对方在沟通时的态度，而非仅仅是钱的问题，对吗？",
      "您刚才提到，这套房子凝聚了您大半辈子的心血，我非常理解这种情感寄托。",
      "让我确认一下，您的主要诉求是希望对方能够承认错误并道歉，而不仅仅是经济补偿，是这样吗？"
    ],
    pitfalls: [
      "急于打断当事人进行法律评判。",
      "机械式重复，显得敷衍而不真诚。",
      "在当事人情绪激动时过早总结，打断其宣泄过程。"
    ]
  },
  {
    name: "换位思考 (Reframing)",
    category: "沟通技巧",
    description: "引导一方站在另一方的角度考虑问题，弱化指责，寻找共情点。",
    howToUse: "通过'如果换做是你'等引导语，将被动的指责转化为主动的理解。",
    phrasings: [
      "如果换做您在对方的位置，面对同样的经济压力，您会希望对方怎么做？",
      "对方其实也表达了想尽快解决问题的意愿，这和您的初衷是一致的。",
      "我们不妨想想，如果这件事发生在您身上，您希望得到什么样的处理？"
    ],
    pitfalls: [
      "强行要求弱势方体谅强势方，导致反感。",
      "在双方情绪高昂时生硬切换角度。",
      "过度使用导致当事人认为调解员偏袒对方。"
    ]
  },
  {
    name: "情绪疏导 (Emotional Validation)",
    category: "沟通技巧",
    description: "承认并接纳当事人的情绪，而不是试图立即解决问题或否定感受。",
    howToUse: "当当事人情绪激动时，先表达理解和共情，让情绪得到释放后再引导理性讨论。",
    phrasings: [
      "我完全理解您现在的心情，遇到这样的事情确实让人非常气愤。",
      "您的感受是完全可以理解的，任何人遇到这种情况都会感到委屈。",
      "让我们先缓一缓，我理解您现在的情绪，等您心情平复一些我们再继续。"
    ],
    pitfalls: [
      "过度共情导致当事人情绪进一步激化。",
      "只关注情绪而忽略了实际问题解决。",
      "对不同当事人的情绪处理方式不当，造成不公平感。"
    ]
  },
  {
    name: "开放式提问 (Open-ended Questions)",
    category: "沟通技巧",
    description: "使用开放式问题引导当事人深入思考，发现更多信息和可能性。",
    howToUse: "避免用'是'或'否'能回答的问题，多用'什么'、'如何'、'为什么'等引导性提问。",
    phrasings: [
      "您能详细说说当时的具体情况吗？",
      "除了这个方案，您觉得还有哪些可能的解决办法？",
      "您认为理想的解决方案应该是什么样的？"
    ],
    pitfalls: [
      "问题过于宽泛，导致当事人不知从何说起。",
      "在当事人已经明确表达后仍反复提问，显得不信任。",
      "提问时机不当，打断当事人的思路。"
    ]
  },
  {
    name: "背对背调解 (Caucus)",
    category: "程序控制",
    description: "将矛盾激化的双方分开谈话，打破僵局，挖掘真实底线。",
    howToUse: "当场面失控或涉及隐私利益不便公开说时，果断采取单独谈话模式。",
    phrasings: [
      "现在大家情绪都比较激动，为了更高效地解决问题，我想请二位分别单独聊聊。",
      "在单独谈话中，您可以更放心地告诉我您的真实想法，我会为您保密。",
      "让我们先分开谈谈，这样您可以更自由地表达想法，不用担心对方在场的影响。"
    ],
    pitfalls: [
      "时间分配不均，让等待的一方感到被冷落或怀疑偏袒。",
      "传递虚假信息或误导当事人。",
      "过度使用导致当事人对调解员失去信任。"
    ]
  },
  {
    name: "程序释明 (Procedural Explanation)",
    category: "程序控制",
    description: "在调解开始前，向当事人说明调解的程序、原则和双方的权利义务。",
    howToUse: "在正式调解前，清晰说明调解的自愿性、保密性、中立性等基本原则。",
    phrasings: [
      "在开始之前，我需要向二位说明一下调解的基本原则：调解是自愿的，任何一方都可以随时退出；调解过程是保密的；我会保持中立，不会偏袒任何一方。",
      "调解的目的是帮助双方找到都能接受的解决方案，而不是判定谁对谁错。",
      "如果调解成功，我们会形成调解协议；如果调解不成，您仍然可以通过诉讼等方式解决。"
    ],
    pitfalls: [
      "释明过于冗长，让当事人失去耐心。",
      "释明不充分，导致当事人对程序产生误解。",
      "在当事人情绪激动时进行程序释明，效果不佳。"
    ]
  },
  {
    name: "议程设置 (Agenda Setting)",
    category: "程序控制",
    description: "为调解过程设定清晰的议程，有序推进各个议题的讨论。",
    howToUse: "在调解开始时，与当事人共同确定讨论的议题顺序，先易后难，逐步推进。",
    phrasings: [
      "让我们先确定一下今天要讨论的几个问题，先从双方都认可的事实开始，然后再讨论有争议的部分。",
      "我建议我们先讨论维修方案，因为这部分双方分歧较小，然后再谈赔偿金额。",
      "按照议程，我们已经完成了事实确认，现在进入方案讨论阶段。"
    ],
    pitfalls: [
      "议程设置过于僵化，无法应对突发情况。",
      "忽略当事人的意见，强行按照自己的思路推进。",
      "议程设置不合理，导致重要问题被遗漏。"
    ]
  },
  {
    name: "时间管理 (Time Management)",
    category: "程序控制",
    description: "合理控制调解节奏，避免无意义的重复和拖延，保持调解效率。",
    howToUse: "设定时间节点，适时提醒当事人聚焦核心问题，避免在细枝末节上浪费时间。",
    phrasings: [
      "我们已经讨论了半个小时，让我们聚焦到核心问题上，看看能否找到解决方案。",
      "时间有限，我建议我们先搁置这个细节问题，先解决主要争议。",
      "让我们暂停一下，给双方一点时间思考刚才讨论的方案。"
    ],
    pitfalls: [
      "时间控制过严，导致当事人感到被催促。",
      "时间管理不当，导致重要问题讨论不充分。",
      "没有给当事人足够的思考时间，急于达成协议。"
    ]
  },
  {
    name: "利益分析 (Interest-based)",
    category: "谈判策略",
    description: "从表面的立场（我要XX钱）转向深层的利益（为什么我要这笔钱）。",
    howToUse: "不断追问'为什么'，寻找金钱以外的替代方案，如道歉、分期或劳务抵债。",
    phrasings: [
      "除了这笔赔偿金，还有什么方式能让您觉得这件事处理得圆满？",
      "我们看看，除了金钱补偿，是否能在维修工期或质量保证上给您更多支持？",
      "您要这笔钱主要是为了什么？是补偿损失，还是希望对方认识到错误？"
    ],
    pitfalls: [
      "忽略法律底线，纯粹进行商业化讨价还价。",
      "过早亮出自己的调解方案。",
      "过度挖掘利益，导致当事人感到被冒犯。"
    ]
  },
  {
    name: "分阶段妥协 (Log-rolling)",
    category: "谈判策略",
    description: "将争议点拆分，用次要问题的让步换取主要问题的解决。",
    howToUse: "先解决容易达成一致的小问题，积累信任感，再攻坚核心争议。",
    phrasings: [
      "既然二位对修漏水本身没异议，我们先把维修方案定下来，赔偿细节再细谈。",
      "他在工期上退了一步，您看在结款方式上能不能也给点便利？",
      "我们先解决双方都认可的部分，建立互信，然后再讨论有分歧的地方。"
    ],
    pitfalls: [
      "主次颠倒，在细枝末节上浪费太多精力。",
      "没有达成整体协议前，让步被对方视为理所当然。",
      "分阶段妥协导致最终方案支离破碎，缺乏整体性。"
    ]
  },
  {
    name: "最佳替代方案 (BATNA)",
    category: "谈判策略",
    description: "帮助当事人评估如果不达成调解协议，他们有哪些替代选择及其成本。",
    howToUse: "客观分析诉讼、仲裁等替代方案的时间成本、经济成本和风险，引导当事人理性选择。",
    phrasings: [
      "如果调解不成，您打算怎么办？诉讼的话，大概需要多长时间和多少费用？",
      "我们不妨比较一下：调解方案和您通过诉讼可能得到的结果，哪个更符合您的实际需求？",
      "考虑到诉讼的时间成本和不确定性，调解方案虽然可能不是最理想的，但可能是最实际的。"
    ],
    pitfalls: [
      "过度强调替代方案的成本，让当事人感到被威胁。",
      "对替代方案的分析不客观，误导当事人。",
      "在当事人情绪激动时讨论替代方案，效果不佳。"
    ]
  },
  {
    name: "锚定效应 (Anchoring)",
    category: "谈判策略",
    description: "通过设定合理的起始点，影响当事人对解决方案的预期。",
    howToUse: "在讨论赔偿金额等具体数字时，先提出一个合理的参考范围，引导双方在此基础上协商。",
    phrasings: [
      "根据类似案例，这类纠纷的赔偿金额通常在X到Y之间，我们可以在这个范围内讨论。",
      "我建议我们先确定一个双方都能接受的底线，然后在此基础上寻找平衡点。",
      "让我们先看看，如果按照市场标准，这个问题的合理解决范围应该在哪里？"
    ],
    pitfalls: [
      "锚定值设置不合理，导致一方感到不公平。",
      "过度依赖锚定效应，忽略了当事人的实际需求。",
      "锚定值过于具体，限制了协商空间。"
    ]
  },
  {
    name: "一揽子方案 (Package Deal)",
    category: "谈判策略",
    description: "将多个争议点打包成一个整体方案，增加协商的灵活性和成功率。",
    howToUse: "将金钱、时间、方式等多个要素组合成综合方案，让双方都能在不同方面有所收获。",
    phrasings: [
      "我建议我们制定一个一揽子方案：在赔偿金额上您退一步，在付款方式上对方给您便利，这样双方都能接受。",
      "让我们把维修、赔偿、道歉这几个问题放在一起考虑，看看能否找到一个整体解决方案。",
      "这个方案虽然在某些方面可能不是最理想的，但整体上对双方都是有利的。"
    ],
    pitfalls: [
      "一揽子方案过于复杂，当事人难以理解和接受。",
      "方案设计不合理，导致一方明显吃亏。",
      "没有充分征求当事人意见，强行打包。"
    ]
  },
  {
    name: "事实确认 (Reality Testing)",
    category: "法律适用",
    description: "通过法律预判和社会常识，客观分析不达成和解的成本和后果。",
    howToUse: "在当事人坚持不合理要求时，用中立的态度分析诉讼成本、时间损耗及证据风险。",
    phrasings: [
      "如果您坚持起诉，根据目前的证据，鉴定费和法律成本可能会占据您诉求的一半。",
      "我们国家《民法典》对此有明确规定，类似的案例法院通常的判定范围是...",
      "从法律角度看，您的诉求有一定合理性，但完全实现的可能性不大，因为..."
    ],
    pitfalls: [
      "像法官一样直接下判决，破坏调解的中立性。",
      "威逼恐吓当事人接受方案。",
      "法律分析不准确，误导当事人。"
    ]
  },
  {
    name: "法律释明 (Legal Explanation)",
    category: "法律适用",
    description: "向当事人解释相关法律规定，帮助其理解法律依据和可能的判决结果。",
    howToUse: "在当事人对法律理解有偏差时，客观解释相关法条和司法解释，但不做具体判决预测。",
    phrasings: [
      "根据《民法典》第XXX条的规定，这类情况的法律适用原则是...",
      "我需要向您说明一下，法律上对这类纠纷的处理原则是...",
      "虽然法律有相关规定，但具体判决还要看证据和具体情况，这就是为什么调解可能更灵活。"
    ],
    pitfalls: [
      "过度解释法律，让当事人感到被说教。",
      "法律解释不准确，导致当事人误解。",
      "在当事人情绪激动时进行法律释明，效果不佳。"
    ]
  },
  {
    name: "证据评估 (Evidence Assessment)",
    category: "法律适用",
    description: "帮助当事人客观评估现有证据的证明力和可能的法律后果。",
    howToUse: "在当事人对诉讼结果过于乐观或悲观时，客观分析证据情况，引导其理性决策。",
    phrasings: [
      "从证据角度看，您这边有合同、收据等书面证据，这是有利的；但对方提出的反驳也有一定道理。",
      "如果进入诉讼程序，法院会如何认定这些证据，我们需要客观评估一下。",
      "证据的证明力不是绝对的，法院会综合考虑各种因素，这就是为什么调解可能更可控。"
    ],
    pitfalls: [
      "过度分析证据，让当事人对诉讼失去信心。",
      "证据评估不客观，误导当事人。",
      "在证据不足时过度强调风险，导致当事人不敢主张权利。"
    ]
  },
  {
    name: "风险提示 (Risk Warning)",
    category: "法律适用",
    description: "客观告知当事人不同选择可能面临的法律风险和不确定性。",
    howToUse: "在当事人需要做出重要决定时，全面分析各种选择的风险和收益，帮助其做出理性选择。",
    phrasings: [
      "我需要提醒您，如果选择诉讼，虽然可能获得更多赔偿，但也存在败诉的风险和成本。",
      "调解协议一旦达成并签字，就具有法律效力，双方都要遵守，这一点需要明确。",
      "无论是调解还是诉讼，都有各自的利弊，关键是要选择最适合您实际情况的方式。"
    ],
    pitfalls: [
      "过度强调风险，让当事人感到恐惧。",
      "风险提示不全面，导致当事人做出错误决定。",
      "在当事人已经决定后仍反复提示风险，显得不信任。"
    ]
  }
];

export const SCENARIOS: Scenario[] = [
  {
    id: '1',
    title: '邻里漏水赔偿纠纷',
    category: '民事纠纷',
    difficulty: Difficulty.EASY,
    description: '楼上住户漏水导致楼下装修受损，双方就赔偿金额及维修方案产生严重分歧。',
    partyA: {
      name: '王大妈',
      trait: '守旧、固执、爱面子',
      background: '退休教师，独居，对自家的装修有着极高的情感寄托。'
    },
    partyB: {
      name: '李先生',
      trait: '焦躁、务实、防御性强',
      background: '私企中层，工作压力大，认为王大妈在敲诈勒索。'
    },
    disputePoint: '赔偿金额与维修范围的对立，以及沟通态度恶劣。'
  },
  {
    id: '2',
    title: '小微企业货款清偿',
    category: '商事调解',
    difficulty: Difficulty.MEDIUM,
    description: '受经济波动影响，甲方拖欠乙方货款半年，乙方资金链告急，双方各执一词。',
    partyA: {
      name: '陈总',
      trait: '悲愤、急功近利',
      background: '供应商，面临破产危机，对甲方极度不信任。'
    },
    partyB: {
      name: '赵总',
      trait: '逃避、世故、推诿',
      background: '采购方，确实经营困难，但习惯性拖延付款。'
    },
    disputePoint: '还款期限与逾期利息的平衡。'
  },
  {
    id: '3',
    title: '老旧小区电梯加装',
    category: '社区治理',
    difficulty: Difficulty.HARD,
    description: '高层住户强烈要求加装电梯，低层住户以影响采光和噪音为由誓死反对。',
    partyA: {
      name: '张爷爷',
      trait: '迫切、不善表达',
      background: '六楼住户，患有腿疾，加装电梯是其唯一的外出希望。'
    },
    partyB: {
      name: '刘女士',
      trait: '尖锐、维权意识极强',
      background: '一楼住户，从事法律相关工作，极其看重不动产价值。'
    },
    disputePoint: '补偿方案的制定及底层住户的利益平衡。'
  }
];

export const SYSTEM_INSTRUCTIONS = `
你是一名资深的中国人民调解员导师。你正在带领一名新人调解员进行实战模拟。
你的任务是：
1. 扮演调解场景中的"当事人"角色（A或B，或两者对话）。
2. 在每一轮对话中给出实时的秘密指导建议（coachTip）。
3. 必须从提供的调解技巧库中选择最匹配当前情况的一个技巧名称（recommendedSkillName）。
   技巧库包含：${SKILLS_LIBRARY.map(s => s.name).join('、')}。
4. 动态监测当事人的情绪值（moodA, moodB，0为极度愤怒/不配合，100为完全和解）。

输出格式要求：必须返回JSON对象。
{
  "reply": "当事人的直接回应（包含动作描述）",
  "coachTip": "针对用户这一步操作的点评和下一步动作的建议",
  "recommendedSkillName": "技巧库中的名字，如果不匹配则留空",
  "moodA": 50,
  "moodB": 50
}
`;
